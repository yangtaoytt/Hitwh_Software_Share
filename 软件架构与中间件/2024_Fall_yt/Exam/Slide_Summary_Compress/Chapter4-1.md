# Chapter4-1

### 1. 数据的定义

(1)**一般而言**，数据是指对客观事件进行记录并可以鉴别的符号，是对客观事物的性质、状态以及相互关系等进行记载的物理符号或这些物理符号的组合。它是可识别的、抽象的符号. (2)**表示形态上**，数据可以是狭义上的数字，可以是具有一定意义的文字、字母、数字符号的组合、图形、图像、视频、音频等，也可以是客观事物的属性、数量、位置及其相互关系的抽象表示. (3)**在计算机科学**中，数据是指所有能输入到计算机并被计算机程序处理的符号的介质的总称，是用于输入电子计算机进行处理，具有一定意义的数字、字母、符号和模拟量等的通称.

### 2. 数据与信息的联系和区别

(1)数据是信息的表达、载体，信息是数据的内涵，是形与质的关系. (2)数据本身没有意义，数据只有对实体行为产生影响时才成为信息.

### 3. 数据与语义的关系

(1)数据的表现形式还不能完全表达其内容，需要经过解释，数据和关于**数据的解释**是不可分的. (2)**数据的解释**是指对数据含义的说明，数据的含义称为数据的语义，数据与其**语义**是不可分的.

### 4. 数据的软件价值

数据+语义+逻辑=业务. 代码+业务=软件应用系统.

### 5. 数据带来的变化

(1)**数据**：海量离散. (2)**语义**：异构. (3)**逻辑**：复杂多用户多片段. (4)**业务**：单机到互用性到跨界，自定义用户数据，loTdata. (5)**软件应用系统**：面向海量数据的高并发复杂分布式异构系统.

### 6. 数据架构的变化

(1)单机MySQL. (2)Memcached+Mysql+垂直分离. (3)Mysql主从读写分离. (4)分库分表+水平拆分+Mysql集群. (5)Nosql.

### 7. 单机Mysql的问题

(1)数据量过大，**单机存储**不下. (2)数据量过大，单机内存**存不下数据索引**,索引是加速数据库访问效率的一种机制，存储于内存，数据量越大，索引越大，内存消耗越多，每当加入数据，都需要维持索引，不做优化，数据访问将非常缓慢. (3)访问量过大，在**读写混合的情况**下，一个实例不能承受.

### 8. 缓存原则

频繁被访问的数据可以被放置于缓存当中，以供频繁访问.

### 9. 垂直分离

按业务划分将不同的数据**放在不同的数据库**里.

### 10. Mysql主从复制和读写分离做法

(1)**主从复制**：容灾备份，缓存备份，保证数据的完整性. (2)**读写分离**：增删改是写，查为读。“读”的职能允许从被查询的数据库服务器读数据。“写”的职能允许向写数据的数据库服务器写数据。分工明确，结合缓存能实现性能的一大提升.

### 11. 为什么使用分库分表+水平拆分+Mysql集群

(1)数据库中的数据量不一定是可控的，在未进行分库分表的情况下，随着时间和业务的发展，库中的**表会越来越多**，表中的数据量也会越来越大，相应地，数据操作，增删改查的**开销也会越来越大**.(2)另外，由于无法进行分布式部署，而一台**服务器的资源**（CPU、磁盘、内存、IO等）是有限的，最终数据库所能承载的数据量、数据处理能力都将遭遇瓶颈.

### 12. 云时代对DB的新需求

(1)**高性能** - 对数据库高并发读写的需求。数据库并发负载非常高，往往要达到每秒上万次读写请求，硬盘IO无法承受. (2)**海量存储** - 对海量数据的高效率存储和访问的需求。对海量数据进行SQL查询，效率极其低下不可忍受. (3)**高伸缩性与高可用性** - 对数据库的高可扩展性和高可用性的需求。无法通过简单添加更多的硬件和服务节点来扩展性能和负载能力，需要停机维护和数据迁移.

### 13. 数据层非功能需求与架构技术

(1)**存储高性能**。读写分离、数据缓存、分库分表、NoSQL. (2)**存储高可用**。主从、CAP理论. (3)**存储高扩展**。分库分表、NoSQL.

### 14. 读写分离基本原理

将数据库读写操作**分散到不同的节点**上. (1)数据库服务器搭建主从集群，一主一从、一主多从都可以. (2)数据库主机负责读写操作，从机只负责读操作. (3)数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据. (4)业务服务器将写操作发给数据库主机，将读操作发给数据库从机.

### 15. 主丛复制延迟问题的定义

如果业务服务器将数据写入到数据库主服务器后立刻进行读取，此时读操作访问的是从机，主机还没有将数据复制过来，到从机读取数据是读不到最新数据的，业务上就可能出现问题.

### 16. 应对复制延迟的方案

(1)写操作后的读操作指定发给数据库主服务器. (2)读从机失败后再读一次主机. (3)关键业务读写操作全部指向主机，非关键业务采用读写分离.

### 17. 分配机制的分类

程序代码封装或中间件封装.

### 18. 主备复制实现

(1)主机存储数据，通过复制通道将数据复制到备机. (2)正常情况下，客户端无论读写操作，都发送给主机，备机不对外提供任何读写服务. (3)主机故障情况下，客户端不会自动将请求发给备机，此时整个系统处于不可用状态，不能读写数据，但数据并没有全部丢失，因为备机上有数据. (4)如果主机能够恢复（人工或自动），客户端继续访问主机，主机继续将数据复制给备机. (5)如果主机不能恢复，则需要人工升级备机为主机，增加新备机，切换访问链路. (6)主机不能恢复的情况下，成功写入主机但还没有复制到备机的数据会丢失，需要人工进行排查和恢复，也许有的数据就永远丢失了，业务上需要考虑如何应对此类风险. (7)如果主从间数据复制延迟，由于备机并不对外提供读写操作，因此对业务没有影响，但如果延迟较多，恰好此时主机又宕机了，则可能丢失较多数据，因此对于复制延迟也不能掉以轻心。一般的做法是做复制延迟的监控措施，当延迟数据量较大时及时预警，由人工干预处理.

### 19. 主从复制优缺点分析

**优点**：（1)对于客户端来说，不需要感知备机的存在，即使灾难恢复后，原来的备机被人工修改为主机后，对于客户端来说，只是认为主机的地址换了，无需知道是原来的备机升级为主机了. (2)对于主机和备机来说，双方只需要进行数据复制即可，无须进行状态判断和主备倒换等复杂操作. **缺点**：（1)备机仅是备份，不提供读写操作，硬件浪费. (2)故障后需人工干预，无法自动恢复.

### 20. 主备复制和主从复制设计的关键

(1)主备间状态判断：状态传递方式. 状态检测原因. (2)倒换决策：倒换时机. 倒换策略. 自动程度. (3)数据冲突.

### 21. 互连式架构定义

主备机直接建立状态传递的渠道. (1)可以是网络连接（如，各开一个端口），也可以是非网络连接（用串口线连接）. (2)可以是主机发送状态给备机，也可以是备机拉取主机的状态. (3)可以和数据复制通道共用，也可以独立一条通道. (4)状态传递通道可以是一条，也可以是多条，还可以是不同类型的通道混合（如，网络+串口）.

### 22. 如何充分利用主备自动倒换方案

(1)主备机共享一个对于客户端来说唯一的地址（如，虚拟IP）. (2)客户端记录主备机各自的IP，备机具有拒绝服务的能力.

### 23. 互连式架构缺点

(1)状态传递通道本身故障了，则备机会主动升级为主机. (2)虽然可以通过多通道来降低通道故障的机率，但是通道越多，后续的状态决策越复杂，特别是容易收到多种矛盾的信息.

### 24. 中介式架构定义

在主备机之间引入第三方中介，主备机之间不直接连接，而都去连接中介，并且通过中介来传递状态信息. **优点**：(1)**连接管理**更简单：主备机无须再建立和管理多种类型的状态传递连接通道，只要连接到中介即可，实际上降低了主备机的连接复杂度. (2)**状态决策**更简单：无须考虑多种类型的连接通道获取状态信息如何决策的问题. **缺点**：结构复杂了.

### 25. 中介式架构决策步骤

(1)无论主机还是备机，初始状态都是备机，并且只要与中介断开连接，就将自己降级为备机，因此可能出现双备机的情况. (2)主机与中介断连后，中介能够立刻告知备机，备机将被升级为主机. (3)如果是网络中断导致主机与中介断连，主机自己会降级为备机，网络恢复后，旧的主机以新的备机身份向中介上报自己的状态. (4)如果是掉电重启或者进程重启，旧的主机初始状态为备机，与中介恢复连接后，发现已经有主机了，保持自己备机状态不变. (5)主备机与中介连接都正常的情况下，按照实际的状态决定是否进行倒换，如，响应超时.

### 26. 模拟式架构定义

主备机之间并不传递任何状态数据，而是备机模拟成为一个客户端，向主机发起模拟的读写操作，根据读写操作的响应情况来判断主机的状态.

### 27. 模拟式架构与互连对比

**模拟式**相比**互连式**的优缺点: (1)实现更加简单，省去了状态传递通道的建立和管理工作.; (2)模拟式读写操作获取状态信息只有响应信息（如，HTTP404，超时，响应时间超过3s等），没有互连式那么多样，基于有限的状态来做状态决策，可能出现偏差.

### 28. 主主复制定义及做法

两台机器都是主机，互相将数据复制给对方，客户端可以任意挑选其中一台进行读写操作. (1)两台主机都存储数据，通过复制通道将数据复制到另一台主机. (2)正常情况下，客户端可以将读写操作发送给任意一台主机. (3)一台主机故障情况下，客户端只需要将读写操作发送给主机B即可，反之亦然. (4)如果故障主机能够恢复，则客户端继续访问两台主机，两台主机继续相互复制对方数据. (5)如果故障主机不能恢复，则需要人工操作，增加一台新的机器为主机. (6)原有故障主机不能恢复的情况下，成功写入原有故障主机但没有复制到正常主机的数据会丢失. (7)如果两台主机间复制延迟，则可能出现客户端刚写入的数据，在另一台主机上读取不到.

### 29. 主主复制的优缺点

**优点**：(1)两台主机，无倒换概念. (2)客户端无须区分主备机身份. (3)必须保证数据能够双向复制，然而很多数据无法双向复制. **缺点**：数据双向复制复杂，容易产生数据冲突.

### 30. 数据集中集群的定义

数据集中集群称为一主多备/从。数据都只能往主机写，而读操作可以参考主备，主从的架构进行灵活变化.

### 31. 数据集中集群的特点

**复杂度高**：（1)多备即多通道，增加了主机的复制压力，同时增加了对正常读写的压力（实践中，需要考虑降低该压力）; (2)多通道，情况不一，容易导致数据不一致，需要在备机之间进行数据一致性检查和修正; (3)多备对单主状态的检测结果不一致，容易出现不同的判断和决策; (4)单主多备，当主机宕机，如何重新选主，需要算法.

### 32. 数据分散集群的定义

数据分散集群指多个服务器组成一个集群，每台服务器都会负责存储一部分数据，同时，为了提升硬件利用率，每台服务器又会备份一部分数据.

### 33. 数据分散集群的特点

数据分散集群的复杂度在于如何将数据分配到不同的服务器上，需要思考的方面有： (1)**均衡性**：保证数据分区基本均衡. (2)**容错性**：部分服务器故障后，这些服务器上的数据分区需要分配给其他服务器. (3)**可伸缩性**：当集群容量不够，扩充新的服务器后，算法能够自动将数据分区迁移到新服务器，并保证扩容后所有服务器的均衡性.

### 34. 数据分散集群中的特别角色

数据分散集群中，必须要有一个角色来负责执行数据分配算法，可以是独立服务器，如HDFS架构. 也可以是集群选举出的服务器，也称之为“主机”，但职责完全不同，如Elasticsearch.

### 35. 数据集中集群VS数据分散集群

(1)**写数据角色**。数据集中集群架构中，客户端只能将数据写到主机. 数据分散集群架构中，客户端可以向任意服务器中读写数据. (2)**应用场景**。数据集中集群适合数据量不大，集群机器数量不多的场景，如ZooKeeper集群，一般个位数机器. 数据分散集群，由于其良好的可伸缩性，适合业务数据量巨大、集群机器数量庞大的业务场景，如Hadoop集群，可达上千台服务器.